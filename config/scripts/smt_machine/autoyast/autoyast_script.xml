  <scripts>
   <init-scripts config:type="list">
    <script>
      <debug config:type="boolean">false</debug>
      <filename>set_authorized_keys.sh</filename>
      <location><![CDATA[]]></location>
      <source><![CDATA[#!/bin/sh
# Create shared SSH keys
mkdir -p /root/.ssh
echo "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQDOo2oZvop3Uj7G9VYUYJ02hpD75ookCjmPtJe7fjc2Ot6pBf/cVM1HasMiP5hLHwjDkR0KXVDPp7uLzZFsjvFkscrUkHTNDTptJcuUiP9dR9aH8SvI4X7rMTjvjGqMkj9jGm2lBb0foxoxQ1HJbGws8Cun8KnlZ5LEitc5xsuVK4iNE1bgKcgXI50TY8BQFc2F18vK56L5GAULctZVrGVM0E6igwerHYCmGbvJSkEAPPi7O/EDc4OED9dSGXSh3r98jAAwq6+hooapM2lWv33qslB/iQUzIMDs7Fyk5PnDbhfHP+kj/NIXwJppNM/ReJUNHY+tFE1UdeK8VTftYYh7cdTUQypERvegyuzfpZLCbu8IMXcY4l5CpmNnzuIgvGBoxSeAHYDd9TIqk7q2eUrJ5ESBt0ncXhKFhEs66+nVFi77lJapNfRFS3lQ6YAjdvJLQ/P25HCerFbhPM5XdFpqYzIbjMiqN3qaHRJmxe8AvQyjTYzKeSmgpdiq4r1n70ahYeQ3QKSwQrNgMYbaI4MOLQ38H7acpUPv5N+xy5C65uEqi4yHWufUDgOIwVjmNgjHQ268oCqUDLHQP8W9WWqH9NDbjG4WUMt871jZ5EraEs6lO+oT9TXcK7cIIgCRqhk+9dQnv8dcxH9Vgk6cDlpxdHq5Q/2UFx3XHb50b1mC1Q== root@admin
" > /root/.ssh/authorized_keys
echo "-----BEGIN RSA PRIVATE KEY-----
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
-----END RSA PRIVATE KEY-----
" > /root/.ssh/id_rsa
echo "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQDOo2oZvop3Uj7G9VYUYJ02hpD75ookCjmPtJe7fjc2Ot6pBf/cVM1HasMiP5hLHwjDkR0KXVDPp7uLzZFsjvFkscrUkHTNDTptJcuUiP9dR9aH8SvI4X7rMTjvjGqMkj9jGm2lBb0foxoxQ1HJbGws8Cun8KnlZ5LEitc5xsuVK4iNE1bgKcgXI50TY8BQFc2F18vK56L5GAULctZVrGVM0E6igwerHYCmGbvJSkEAPPi7O/EDc4OED9dSGXSh3r98jAAwq6+hooapM2lWv33qslB/iQUzIMDs7Fyk5PnDbhfHP+kj/NIXwJppNM/ReJUNHY+tFE1UdeK8VTftYYh7cdTUQypERvegyuzfpZLCbu8IMXcY4l5CpmNnzuIgvGBoxSeAHYDd9TIqk7q2eUrJ5ESBt0ncXhKFhEs66+nVFi77lJapNfRFS3lQ6YAjdvJLQ/P25HCerFbhPM5XdFpqYzIbjMiqN3qaHRJmxe8AvQyjTYzKeSmgpdiq4r1n70ahYeQ3QKSwQrNgMYbaI4MOLQ38H7acpUPv5N+xy5C65uEqi4yHWufUDgOIwVjmNgjHQ268oCqUDLHQP8W9WWqH9NDbjG4WUMt871jZ5EraEs6lO+oT9TXcK7cIIgCRqhk+9dQnv8dcxH9Vgk6cDlpxdHq5Q/2UFx3XHb50b1mC1Q== root@admin
" > /root/.ssh/id_rsa.pub
chmod -R 600 /root/.ssh

# Add pre-created smt ca certificate for smt.example.com
echo "-----BEGIN CERTIFICATE-----
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
-----END CERTIFICATE-----
" > /etc/pki/trust/anchors/smt_ca.pem
/usr/sbin/update-ca-certificates

# Add Preconfigured /etc/containers/registries.conf
cp /etc/containers/registries.conf /etc/containers/registries.conf.original
echo '
[[registry]]
prefix = "registry.suse.com"
location = "smt.example.com:5000/registry.suse.com"
[[registry]]
prefix = "docker.io"
location = "smt.example.com:5000/docker.io"
[[registry]]
prefix = "quay.io"
location = "smt.example.com:5000/quay.io"
[[registry]]
prefix = "k8s.gcr.io"
location = "smt.example.com:5000/k8s.gcr.io"
[[registry]]
prefix = "gcr.io"
location = "smt.example.com:5000/gcr.io"
' > /etc/containers/registries.conf
# register VM
SUSEConnect -p caasp/4.0/x86_64 --url http://smt.example.com
SUSEConnect -p SLES/15.1/x86_64 --url http://smt.example.com
SUSEConnect -p sle-module-basesystem/15.1/x86_64 --url http://smt.example.com
SUSEConnect -p sle-module-containers/15.1/x86_64 --url http://smt.example.com
]]>

      </source>
    </script>
   </init-scripts>
  </scripts>
